{
  "name": "code-completion",
  "version": 0.1,
  "imports": [
    "https://get.silverbullet.md/global.plug.json"
  ],
  "functions": {
    "fullTextCompletion": {
      "command": {
        "name": "OpenAI: Full Page Completion"
      },
      "code": "(() => { var mod=(()=>{var M=Object.create;var a=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var R=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(r,n)=>(typeof require!=\"undefined\"?require:r)[n]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var c=(e,r)=>{for(var n in r)a(e,n,{get:r[n],enumerable:!0})},b=(e,r,n,o)=>{if(r&&typeof r==\"object\"||typeof r==\"function\")for(let i of A(r))!N.call(e,i)&&i!==n&&a(e,i,{get:()=>r[i],enumerable:!(o=S(r,i))||o.enumerable});return e};var O=(e,r,n)=>(n=e!=null?M(k(e)):{},b(r||!e||!e.__esModule?a(n,\"default\",{value:e,enumerable:!0}):n,e)),q=e=>b(a({},\"__esModule\",{value:!0}),e);var be={};c(be,{default:()=>ye});typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var t=self.syscall;var s={};c(s,{dispatch:()=>Z,enableReadOnlyMode:()=>re,filterBox:()=>D,flashNotification:()=>z,getCurrentPage:()=>K,getCursor:()=>F,getSelection:()=>_,getText:()=>Y,hidePanel:()=>Q,insertAtCursor:()=>W,insertAtPos:()=>V,matchBefore:()=>X,moveCursor:()=>H,navigate:()=>I,openUrl:()=>U,prompt:()=>ee,reloadPage:()=>$,replaceRange:()=>G,save:()=>B,setPage:()=>L,setSelection:()=>j,showPanel:()=>J});function K(){return t(\"editor.getCurrentPage\")}function L(e){return t(\"editor.setPage\",e)}function Y(){return t(\"editor.getText\")}function F(){return t(\"editor.getCursor\")}function _(){return t(\"editor.getSelection\")}function j(e,r){return t(\"editor.setSelection\",e,r)}function B(){return t(\"editor.save\")}function I(e,r,n=!1){return t(\"editor.navigate\",e,r,n)}function $(){return t(\"editor.reloadPage\")}function U(e){return t(\"editor.openUrl\",e)}function z(e,r=\"info\"){return t(\"editor.flashNotification\",e,r)}function D(e,r,n=\"\",o=\"\"){return t(\"editor.filterBox\",e,r,n,o)}function J(e,r,n,o=\"\"){return t(\"editor.showPanel\",e,r,n,o)}function Q(e){return t(\"editor.hidePanel\",e)}function V(e,r){return t(\"editor.insertAtPos\",e,r)}function G(e,r,n){return t(\"editor.replaceRange\",e,r,n)}function H(e){return t(\"editor.moveCursor\",e)}function W(e){return t(\"editor.insertAtCursor\",e)}function X(e){return t(\"editor.matchBefore\",e)}function Z(e){return t(\"editor.dispatch\",e)}function ee(e,r=\"\"){return t(\"editor.prompt\",e,r)}function re(e){return t(\"editor.enableReadOnlyMode\",e)}var l={};c(l,{parseMarkdown:()=>ne});function ne(e){return t(\"markdown.parseMarkdown\",e)}var u={};c(u,{deleteAttachment:()=>ge,deletePage:()=>le,getAttachmentMeta:()=>me,getPageMeta:()=>se,listAttachments:()=>pe,listPages:()=>ie,listPlugs:()=>ue,readAttachment:()=>de,readPage:()=>ae,writeAttachment:()=>fe,writePage:()=>ce});function ie(e=!1){return t(\"space.listPages\",e)}function se(e){return t(\"space.getPageMeta\",e)}function ae(e){return t(\"space.readPage\",e)}function ce(e,r){return t(\"space.writePage\",e,r)}function le(e){return t(\"space.deletePage\",e)}function ue(){return t(\"space.listPlugs\")}function pe(){return t(\"space.listAttachments\")}function me(e){return t(\"space.getAttachmentMeta\",e)}function de(e){return t(\"space.readAttachment\",e)}function fe(e,r,n){return t(\"space.writeAttachment\",e,r,n)}function ge(e){return t(\"space.deleteAttachment\",e)}var p=class{constructor(r){this.apiKey=r}async createCodeCompletion(r){return(await fetch(\"https://api.openai.com/v1/completions\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify(r)})).json()}async createModeration(r){return(await fetch(\"https://api.openai.com/v1/moderations\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify(r)})).json()}};function f(e,r){if(r(e))return[e];let n=[];if(e.children)for(let o of e.children)n=[...n,...f(o,r)];return n}function g(e,r){return f(e,n=>n.type===r)[0]}function v(e,r){f(e,r)}var P=O(R(\"https://deno.land/std/encoding/yaml.ts\"));async function m(e,r=[\"yaml\"]){let n=await u.readPage(e),o=await l.parseMarkdown(n),i={};return v(o,d=>{if(d.type!==\"FencedCode\")return!1;let x=g(d,\"CodeInfo\");if(!x||!r.includes(x.children[0].text))return!1;let h=g(d,\"CodeText\");if(!h)return!1;let C=h.children[0].text;try{i=P.parse(C)}catch(y){throw console.error(\"YAML Page parser error\",y),new Error(`YAML Error: ${y.message}`)}return!0}),i}async function T(e){try{let r=await m(\"SECRETS\",[\"yaml\",\"secrets\"]),n=[];for(let o of e){let i=r[o];if(i)n.push(i);else throw new Error(`No such secret: ${o}`)}return n}catch(r){throw r.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):r}}async function xe(){try{let[e]=await T([\"openai\"]);return e}catch{console.error(\"No openai token found\")}}async function he(){try{return await m(\"openai/settings\")}catch(e){return console.log(e),[]}}async function w(){let e=await he(),r=await s.getText();e.prompt=r,console.log(e);let n=await xe(),i=await new p(n).createCodeCompletion(e);s.insertAtCursor(i.choices[0].text)}var ye=w;return q(be);})();\n return mod;})()"
    },
    "selectionCompletion": {
      "command": {
        "name": "OpenAI: Selection Completion"
      },
      "code": "(() => { var mod=(()=>{var M=Object.create;var l=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var R=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(r,n)=>(typeof require!=\"undefined\"?require:r)[n]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var u=(e,r)=>{for(var n in r)l(e,n,{get:r[n],enumerable:!0})},b=(e,r,n,o)=>{if(r&&typeof r==\"object\"||typeof r==\"function\")for(let i of A(r))!N.call(e,i)&&i!==n&&l(e,i,{get:()=>r[i],enumerable:!(o=S(r,i))||o.enumerable});return e};var O=(e,r,n)=>(n=e!=null?M(k(e)):{},b(r||!e||!e.__esModule?l(n,\"default\",{value:e,enumerable:!0}):n,e)),q=e=>b(l({},\"__esModule\",{value:!0}),e);var be={};u(be,{default:()=>ye});typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var t=self.syscall;var s={};u(s,{dispatch:()=>Z,enableReadOnlyMode:()=>re,filterBox:()=>D,flashNotification:()=>z,getCurrentPage:()=>K,getCursor:()=>F,getSelection:()=>_,getText:()=>Y,hidePanel:()=>Q,insertAtCursor:()=>W,insertAtPos:()=>V,matchBefore:()=>X,moveCursor:()=>H,navigate:()=>I,openUrl:()=>U,prompt:()=>ee,reloadPage:()=>$,replaceRange:()=>G,save:()=>B,setPage:()=>L,setSelection:()=>j,showPanel:()=>J});function K(){return t(\"editor.getCurrentPage\")}function L(e){return t(\"editor.setPage\",e)}function Y(){return t(\"editor.getText\")}function F(){return t(\"editor.getCursor\")}function _(){return t(\"editor.getSelection\")}function j(e,r){return t(\"editor.setSelection\",e,r)}function B(){return t(\"editor.save\")}function I(e,r,n=!1){return t(\"editor.navigate\",e,r,n)}function $(){return t(\"editor.reloadPage\")}function U(e){return t(\"editor.openUrl\",e)}function z(e,r=\"info\"){return t(\"editor.flashNotification\",e,r)}function D(e,r,n=\"\",o=\"\"){return t(\"editor.filterBox\",e,r,n,o)}function J(e,r,n,o=\"\"){return t(\"editor.showPanel\",e,r,n,o)}function Q(e){return t(\"editor.hidePanel\",e)}function V(e,r){return t(\"editor.insertAtPos\",e,r)}function G(e,r,n){return t(\"editor.replaceRange\",e,r,n)}function H(e){return t(\"editor.moveCursor\",e)}function W(e){return t(\"editor.insertAtCursor\",e)}function X(e){return t(\"editor.matchBefore\",e)}function Z(e){return t(\"editor.dispatch\",e)}function ee(e,r=\"\"){return t(\"editor.prompt\",e,r)}function re(e){return t(\"editor.enableReadOnlyMode\",e)}var p={};u(p,{parseMarkdown:()=>ne});function ne(e){return t(\"markdown.parseMarkdown\",e)}var m={};u(m,{deleteAttachment:()=>ge,deletePage:()=>le,getAttachmentMeta:()=>me,getPageMeta:()=>se,listAttachments:()=>pe,listPages:()=>ie,listPlugs:()=>ue,readAttachment:()=>de,readPage:()=>ae,writeAttachment:()=>fe,writePage:()=>ce});function ie(e=!1){return t(\"space.listPages\",e)}function se(e){return t(\"space.getPageMeta\",e)}function ae(e){return t(\"space.readPage\",e)}function ce(e,r){return t(\"space.writePage\",e,r)}function le(e){return t(\"space.deletePage\",e)}function ue(){return t(\"space.listPlugs\")}function pe(){return t(\"space.listAttachments\")}function me(e){return t(\"space.getAttachmentMeta\",e)}function de(e){return t(\"space.readAttachment\",e)}function fe(e,r,n){return t(\"space.writeAttachment\",e,r,n)}function ge(e){return t(\"space.deleteAttachment\",e)}var d=class{constructor(r){this.apiKey=r}async createCodeCompletion(r){return(await fetch(\"https://api.openai.com/v1/completions\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify(r)})).json()}async createModeration(r){return(await fetch(\"https://api.openai.com/v1/moderations\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify(r)})).json()}};function g(e,r){if(r(e))return[e];let n=[];if(e.children)for(let o of e.children)n=[...n,...g(o,r)];return n}function P(e,r){return g(e,n=>n.type===r)[0]}function v(e,r){g(e,r)}var x=O(R(\"https://deno.land/std/encoding/yaml.ts\"));async function f(e,r=[\"yaml\"]){let n=await m.readPage(e),o=await p.parseMarkdown(n),i={};return v(o,a=>{if(a.type!==\"FencedCode\")return!1;let c=P(a,\"CodeInfo\");if(!c||!r.includes(c.children[0].text))return!1;let h=P(a,\"CodeText\");if(!h)return!1;let C=h.children[0].text;try{i=x.parse(C)}catch(y){throw console.error(\"YAML Page parser error\",y),new Error(`YAML Error: ${y.message}`)}return!0}),i}async function T(e){try{let r=await f(\"SECRETS\",[\"yaml\",\"secrets\"]),n=[];for(let o of e){let i=r[o];if(i)n.push(i);else throw new Error(`No such secret: ${o}`)}return n}catch(r){throw r.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):r}}async function xe(){try{let[e]=await T([\"openai\"]);return e}catch{console.error(\"No openai token found\")}}async function he(){try{return await f(\"openai/settings\")}catch(e){return console.log(e),[]}}async function w(){let e=await s.getText(),r=await s.getSelection(),n=e.slice(r.from,r.to),o=await he();o.prompt=n,console.log(o);let i=await xe(),c=await new d(i).createCodeCompletion(o);s.insertAtPos(c.choices[0].text,r.to)}var ye=w;return q(be);})();\n return mod;})()"
    },
    "readSettings": {
      "command": {
        "name": "OpenAI: Settings"
      },
      "code": "(() => { var mod=(()=>{var w=Object.create;var s=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var k=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(r,t)=>(typeof require!=\"undefined\"?require:r)[t]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var u=(e,r)=>{for(var t in r)s(e,t,{get:r[t],enumerable:!0})},h=(e,r,t,i)=>{if(r&&typeof r==\"object\"||typeof r==\"function\")for(let o of M(r))!A.call(e,o)&&o!==t&&s(e,o,{get:()=>r[o],enumerable:!(i=C(r,o))||i.enumerable});return e};var N=(e,r,t)=>(t=e!=null?w(S(e)):{},h(r||!e||!e.__esModule?s(t,\"default\",{value:e,enumerable:!0}):t,e)),R=e=>h(s({},\"__esModule\",{value:!0}),e);var V={};u(V,{default:()=>Q});typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var n=self.syscall;var a={};u(a,{parseMarkdown:()=>E});function E(e){return n(\"markdown.parseMarkdown\",e)}var c={};u(c,{deleteAttachment:()=>D,deletePage:()=>j,getAttachmentMeta:()=>$,getPageMeta:()=>Y,listAttachments:()=>I,listPages:()=>L,listPlugs:()=>B,readAttachment:()=>U,readPage:()=>F,writeAttachment:()=>z,writePage:()=>_});function L(e=!1){return n(\"space.listPages\",e)}function Y(e){return n(\"space.getPageMeta\",e)}function F(e){return n(\"space.readPage\",e)}function _(e,r){return n(\"space.writePage\",e,r)}function j(e){return n(\"space.deletePage\",e)}function B(){return n(\"space.listPlugs\")}function I(){return n(\"space.listAttachments\")}function $(e){return n(\"space.getAttachmentMeta\",e)}function U(e){return n(\"space.readAttachment\",e)}function z(e,r,t){return n(\"space.writeAttachment\",e,r,t)}function D(e){return n(\"space.deleteAttachment\",e)}function p(e,r){if(r(e))return[e];let t=[];if(e.children)for(let i of e.children)t=[...t,...p(i,r)];return t}function m(e,r){return p(e,t=>t.type===r)[0]}function b(e,r){p(e,r)}var d=N(k(\"https://deno.land/std/encoding/yaml.ts\"));async function f(e,r=[\"yaml\"]){let t=await c.readPage(e),i=await a.parseMarkdown(t),o={};return b(i,l=>{if(l.type!==\"FencedCode\")return!1;let g=m(l,\"CodeInfo\");if(!g||!r.includes(g.children[0].text))return!1;let P=m(l,\"CodeText\");if(!P)return!1;let T=P.children[0].text;try{o=d.parse(T)}catch(x){throw console.error(\"YAML Page parser error\",x),new Error(`YAML Error: ${x.message}`)}return!0}),o}async function v(){try{return await f(\"openai/settings\")}catch(e){return console.log(e),[]}}var Q=v;return R(V);})();\n return mod;})()"
    }
  },
  "assets": {}
}